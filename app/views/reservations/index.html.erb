<h1><%= t('reservations') %></h1>
<aside>
  <table class="tarif_table">
    <tr>
      <th>Nombre de cours / Semaine</th>
      <th>Tarif</th>
      <th><%= t('Durée') %></th>
      <th>Uniforme Gratuit</th>
    </tr>
    <% @tarifs.each do |tarif| %>
      <tr>
        <td><%= tarif.class_per_week %> Cour(s) semaine</td>
        <td><%= tarif.price == 0.0 ? "Veuillez nous contacter" : " %.2f $" % [tarif.price] %></td>
        <td><%= tarif.duration %></td>
        <td><%= tarif.uniform_promotion %></td>
      </tr>
    <% end %>
  </table>
  <p class="reservations">Vos réservations seront activées une fois le paiement effectué.</p>
  <p class="reservations">Notez qu'il est obligatoire de s'inscrire à un minimum de deux fois par semaine une fois rendu
    au niveau intermédiaire, avancé et centure noire (Ceinture Rouge et +)</p>
  <p class="reservations">Les tarifs affichés sont payable aux 2 semaines, toute annulation doit être comuniquée deux semaines à l'avance.</p>
</aside>

<nav class="will_paginate">
  <div class="digg_pagination">
    <div class="page_info">
      <%= page_entries_info @reservations %>
    </div>
    <%= will_paginate @reservations, :container => false %>
  </div>
</nav>
<%= render 'shared/search' if current_admin %>
<section class="new_record">
  <%= link_to "#{t('nouvelle')} #{t('reservation')}", new_reservation_path, id: 'new_reservation' %>

  <% if @reservations.where('reservations.active = false and reservations.mail_sent = false').count > 0 && !current_admin %>
    -
    <%= link_to "#{t('soumettre')} #{t('reservations')}", submit_reservations_path %>

  <% end %>
</section>

<table>
  <thead>
  <tr>
    <th><%= t('student').html_safe %></th>
    <th><%= t('course') %></th>
    <th><%= t('active') %></th>
    <th><%= t('Confirmation requested') %>
    <th><%= t('created_at') %></th>
    <th colspan="3"></th>
  </tr>
  </thead>

  <tbody>
  <% @reservations.each do |reservation| %>
    <tr>
      <% if current_admin %>
        <td>
          <% if reservation.client_name != reservation.student_name %>
            <p class="<%= reservation.active %>"><%= reservation.student_name %> </p>
          <% end %>
          <p class="<%= reservation.active %>"> <%= link_to(reservation.client_name, user_path(reservation.client_id)) %></p>
        </td>
      <% else %>
        <td><p class="<%= reservation.active %>"><%= reservation.student_name %></p></td>
      <% end %>
      <td>
        <p class="<%= reservation.active %>"><%= "#{t(get_week_day(reservation['day_of_week']))}: #{reservation['start_time'].strftime('%H:%M')} - #{reservation['end_time'].strftime('%H:%M')}" %></p>
        <p class="<%= reservation.active %>"><%= " #{reservation['course_type']} - #{reservation['age_group']}" %></p>
      </td>
      <td><p class="<%= reservation.active %>"><%= reservation['active'] ? t('active') : t('inactive') %></p></td>
      <td><p class="<%= reservation.active %>"><%= reservation['mail_sent'] ? t('Oui') : t('Non') %></p></td>
      <td><p class="<%= reservation.active %>"><%= reservation['created_at'].in_time_zone("Eastern Time (US & Canada)").strftime('%d-%m-%Y %H:%M:%S') %></p></td>
      <td><p class="<%= reservation.active %>"><%= link_to t('show'), reservation_url(reservation['id']) %></p></td>
      <td>
        <p class="<%= reservation.active %>">
          <% if current_admin %>
            <%= link_to t('edit'), edit_reservation_path(reservation['id']) %>
          <% end %>
        </p>
      </td>
      <td>
        <p class="<%= reservation.active %>">
          <% if current_admin %>
            <%= link_to t('destroy'), Reservation.find(reservation['id']), method: :delete, data: {confirm: 'Are you sure?'} %>
          <% end %>
        </p>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

